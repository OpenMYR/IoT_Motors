<!DOCTYPE html><html xmlns=http://www.w3.org/1999/xhtml><title>Motor Control</title><meta content="text/html; charset=UTF-8"http-equiv=Content-Type><meta content="This is where you add the website description."name=description><meta content="keywords, for the site, go here, separated, by commas"name=keywords><link href=css/default.css media=screen rel=stylesheet><body id=index_page><div id=wrapper><div id=header><h1>OpenMYR</h1></div><ul id=navigation><li id=contact_us><a href=control.html>Control</a><li id=about_us><a href=config.html>Configure</a><li id=index><a href=index.html>Home</a></ul><div id=content><h2 class=clear>Queue Instructions</h2><button class=styleButton id=clear onclick=clearQueue() style=float:right;margin-top:50px>Clear</button> <button class=styleButton id=march onclick=imperialMarch() style=float:right;margin-top:50px;margin-right:50px>Imperial March</button> <button class=styleButton id=indiana onclick=indianaJones() style=float:right;margin-top:50px;margin-right:50px>Indiana Jones</button><div class=content style=width:100%;clear:both><div class=container style=width:500px;float:right><table class=table-normal id=queue_table><thead><tr><td>Command<td>Code Amount<td>At Speed<tbody id=body></table></div><div class=container style=width:270px;float:left;clear:left;padding-bottom:10px><div class="even spaced"><button class=styleButton id=radio0 onclick=modeSelected(0)>Move</button> <button class=styleButton id=radio1 onclick=modeSelected(1)>Goto</button> <button class=styleButton id=radio2 onclick=modeSelected(2)>Stop</button></div><div class="even spaced"><label style=padding-top:10px id=commandDisplay>Please select a command</label></div><div class="container catagory"><div class="even spaced"><label style=width:100px;text-align:center>Degrees</label><label style=width:100px;text-align:center>Steps</label></div><div class=even><input id=angleInput style=width:100px type=input value=0 onchange=crossCalculate(1)> <input id=stepInput style=width:100px type=input value=0 onchange=crossCalculate(0)></div></div><div class="container catagory"><div class="even spaced"><label style=width:100px;text-align:center>Degrees/Sec</label><label style=width:100px;text-align:center>Steps/Sec</label></div><div class=even><input id=speedAngleInput style=width:100px type=input value=0 onchange=crossCalculate(3)> <input id=speedStepsInput style=width:100px type=input value=0 onchange=crossCalculate(2)></div></div><div class="container catagory"><div class="even spaced"><label>Duration</label></div><div class=even><input id=duration style=width:200px;background-color:#c3c3c3;text-align:center type=input value="0 Seconds"readonly></div></div><div class="even spaced"><input id=add style=width:100px type=button value="Add to Queue"> <input id=execute style=width:100px type=button value="Send Queue"></div></div></div><p id=footer>Go to <a href=http://www.OpenMYR.com/ >OpenMYR.com</a> for more info</div></div><script>function constructRow(e){var t=table.insertRow(table.rows.length);return t.insertCell().innerHTML="<b>"+e.cells[0]+"</b>",t.insertCell().innerHTML=e.cells[1],t.insertCell().innerHTML=e.cells[2],t}function modeSelected(e){selectedButton=e,radioButtons[e].style.backgroundColor="#1A801A",radioButtons[(e+1)%3].style.backgroundColor="#303030",radioButtons[(e+2)%3].style.backgroundColor="#303030",command.innerHTML=buttonCommandDisplays[e],duration.style.backgroundColor=2==e?"#fff":"#c3c3c3",duration.readOnly=2!=e;for(var t=0;4>t;t++)floatInputs[t].style.backgroundColor=2!=e?"#fff":"#c3c3c3",floatInputs[t].readOnly=2==e}function changedFloatInput(){return 13==event.charCode||45==event.charCode||46==event.charCode&&-1==event.target.value.indexOf(".")?!0:void(48<=event.charCode&&57>=event.charCode||(event.preventDefault?event.preventDefault():event.returnValue=!1))}function bluredFloatInput(){var e=parseFloat(event.target.value||0);isNaN(e)?event.target.value=0:event.target.value=e}function bluredTimeInput(){var e=parseFloat(event.target.value||0);isNaN(e)?event.target.value="0 Seconds":event.target.value=e+" Seconds"}function send(e){if(e.commands.length>maxSentCommands){dataParts=[];for(var t=0;t<e.commands.length;t+=maxSentCommands){var a={commands:e.commands.slice(t,Math.min(t+maxSentCommands,e.commands.length))};dataParts.push(a)}e=dataParts.shift()}httpRequest.open("POST","/",!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.send(JSON.stringify(e))}function crossCalculate(e){var t=parseFloat(event.target.value);isNaN(t)&&(t=0),1==e%2?floatInputs[e].value=t*stepsToDegrees:0==e%2&&(floatInputs[e].value=t/stepsToDegrees),0!=floatInputs[3]&&(e=parseInt(floatInputs[1].value),t=Math.round(parseFloat(floatInputs[3].value)),0==t||isNaN(e)||isNaN(t)?duration.value="0 Seconds":duration.value=Math.abs(e/t)+" Seconds"),1==selectedButton&&(duration.value="0 Unknown")}function imperialMarch(){var e=[a,.5,a,.5,a,.5,f,.35,cH,.15,a,.5,f,.35,cH,.15,a,.65,"S",.15,eH,.5,eH,.5,eH,.5,fH,.35,cH,.15,gS,.5,f,.35,cH,.15,a,.65];clearQueue(),playSong(e)}function indianaJones(){var t=[e,.25,c,.125,g,.25,cH,.625,"S",.125,d,.25,e,.125,fH,.625,"S",.125,a,.25,b,.125,cH,.167,dH,.167,eH,.167];clearQueue(),playSong(t)}function playSong(e){addStop(0,0);for(var t=0;t<e.length;t+=2)"S"==e[t]?addStop(1,e[t+1]):(addMove("M",1,10,1500),addMove("M",1,e[t]*e[t+1]*4,4*e[t])),addStop(1,.01)}function isValidCommand(){return isValid=!0,errMessage="",-1==selectedButton&&(errMessage+="Please select a command.\n",isValid=!1),0>Math.round(parseFloat(floatInputs[3].value))&&(errMessage+="Step rate must be positive.\n",isValid=!1),0>Math.round(parseFloat(duration.value))&&2==selectedButton&&(errMessage+="Stop time must be positive.\n",isValid=!1),isValid||alert(errMessage),isValid}function addStop(e,t){stepInputValue=Math.round(stopCountsPerSecond*t),addCommand("S",e,stepInputValue,stopCountsPerSecond)}function addMove(e,t,a,n){a=Math.round(a),n=Math.round(n),addCommand(e,t,a,n)}function addCommand(e,t,a,n){constructRow({cells:[e,a,n]}),commandList.commands.push({code:e,data:[t,a,n]})}function clearQueue(){for(;0<table.rows.length;)table.deleteRow(0);commandList.commands=[]}var stepsPerRotation=400,table=document.getElementById("body"),command=document.getElementById("commandDisplay"),angle=document.getElementById("angleInput"),radioButtons=[document.getElementById("radio0"),document.getElementById("radio1"),document.getElementById("radio2")],floatInputs=[document.getElementById("angleInput"),document.getElementById("stepInput"),document.getElementById("speedAngleInput"),document.getElementById("speedStepsInput")],duration=document.getElementById("duration"),stopCountsPerSecond=1e3,maxSentCommands=10,buttonOpCode=["M","G","S"],buttonCommands=["Move","Goto","Stop"],buttonCommandDisplays=["Move a relative distance.","Goto an absolute position.","Stop and dwell for some time."],c=261,d=294,e=329,f=349,g=391,gS=415,a=440,aS=455,b=466,cH=523,cSH=554,dH=587,dSH=622,eH=659,fH=698,fSH=740,gH=784,gSH=830,aH=880,selectedButton=-1,stepsToDegrees=stepsPerRotation/360,moreDataWaiting=!1,dataParts=[],httpRequest=new XMLHttpRequest;httpRequest.onreadystatechange=function(){4==httpRequest.readyState&&(202==httpRequest.status?0<dataParts.length&&setTimeout(function(){send(dataParts.shift())},1e3):(dataParts=[],alert("An error has occured making the request")))};for(var commandList={commands:[]},i=0;i<floatInputs.length;i++)floatInputs[i].addEventListener("blur",bluredFloatInput),floatInputs[i].addEventListener("keypress",changedFloatInput);duration.addEventListener("blur",bluredTimeInput),document.getElementById("add").addEventListener("click",function(){if(isValidCommand()){var e=0;commandList.commands.length&&(e=1);var t=parseInt(floatInputs[1].value),a=parseFloat(floatInputs[3].value);2==selectedButton?addStop(e,parseFloat(duration.value)):addMove(buttonOpCode[selectedButton],e,t,a)}}),document.getElementById("execute").addEventListener("click",function(){send(commandList)})</script>